<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>ניהול משחקים</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --line:#e6e9f2;
      --text:#1f2430;
      --muted:#6b7280;
      --primary:#4a67ff;
      --primary-600:#3b57ef;
      --danger:#e34b4b;
      --danger-600:#d13e3e;
      --chip:#eef2ff;
      --chip-border:#dfe6ff;
    }
    body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Arial,sans-serif;}
    .wrap{max-width:1000px;margin:32px auto;padding:0 16px;}
    h1{margin:0 0 16px;font-size:28px}
    h2{margin:0 0 12px;font-size:20px}
    .flashes{display:grid;gap:10px;margin:0 0 16px}
    .flash{border-radius:12px;padding:10px 12px;border:1px solid var(--line);background:#fff}
    .flash.success{border-color:#b6e3c2;background:#effbf2}
    .flash.error{border-color:#ffc4c4;background:#fff1f1}
    .flash.info{border-color:#cfe0ff;background:#f3f7ff}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;margin:16px 0;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    label{display:block;margin:8px 0 4px;font-weight:600}
    input[type="text"],textarea,select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;box-sizing:border-box}
    textarea{min-height:120px}
    .btn{padding:9px 14px;border:0;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-danger:hover{background:var(--danger-600)}
    .btn-ghost{background:transparent;border:1px solid var(--line)}
    .grid{display:grid;gap:14px}
    .game{display:grid;grid-template-columns:1fr auto;gap:14px;align-items:center;border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .meta{display:flex;flex-direction:column;gap:4px}
    .title{font-weight:700}
    .muted{color:var(--muted);font-size:12px}
    .chip{display:inline-block;background:var(--chip);border:1px solid var(--chip-border);padding:2px 8px;border-radius:999px;font-size:12px}
    .actions{display:flex;gap:8px}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ניהול משחקים</h1>

  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      <div class="flashes">
        {% for category, msg in messages %}
          {% if category in ['success','error','info'] %}
            <div class="flash {{ category }}">{{ msg }}</div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- טופס הוספת משחק -->
  <div class="card">
    <h2>הוספת משחק חדש</h2>
    <form method="post" enctype="multipart/form-data">
      {{ form.hidden_tag() }}
      <label>כותרת</label>
      {{ form.title() }}
      <label>קטגוריה</label>
      {{ form.category() }}
      <label>תוכן (שורה לכל בולט)</label>
      {{ form.bullets() }}
      <label>תמונה (אופציונלי)</label>
      {{ form.image() }}
      <div style="margin-top:12px;display:flex;gap:10px">
        <button class="btn btn-primary" type="submit">הוסף משחק</button>
        <a class="btn btn-ghost" href="{{ url_for('routes.home') }}">חזרה</a>
      </div>
    </form>
  </div>

  <!-- רשימות משחקים -->
  {% for cat in ["חימום","עיקרי","סיום"] %}
    <div class="card">
      <h2>{{ cat }}</h2>
      {% if games_data[cat] %}
        <div class="grid">
          {% for g in games_data[cat] %}
            <div class="game">
              <div class="meta">
                <div class="title">{{ g.title }}</div>
                <div class="muted">
                  <span class="chip">{{ cat }}</span> · {{ g.bullets|length }} בולטים
                </div>
              </div>
              <div class="actions">
                <form action="{{ url_for('routes.delete_game') }}" method="post" onsubmit="return confirm('למחוק את {{ g.title }}?');">
                  <input type="hidden" name="game_id" value="{{ g.id }}">
                  <input type="hidden" name="category" value="{{ cat }}">
                  <button class="btn btn-danger" type="submit">מחק</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">אין משחקים בקטגוריה זו.</p>
      {% endif %}
    </div>
  {% endfor %}
</div>
</body>
</html>
